<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Registro de Notas</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        /* Ajustes finos de mobile first */
        h4 {
            font-size: 1.2rem;
        }

        @media (min-width: 768px) {
            h4 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body class="bg-light">

<div class="container py-3 py-md-5">
    <div class="card shadow-sm border-0 p-3 p-md-4 mx-auto" style="max-width: 650px;">

        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="fw-bold">Aluno: <%= nomeAluno %></h4><a href="/notas/<%= id_professor %>/<%= id_materia %>/<%= modulo %>">Voltar</a>

            <button class="btn btn-pink rounded-circle">
                <i class="bi bi-list fs-4"></i>
            </button>
        </div>

        <!-- Tags -->
        <div class="mb-3 d-flex flex-column gap-2">
            <span class="badge rounded-pill bg-success-subtle border text-success px-3 py-2">
                ● Matéria - <%= materia %>
            </span>
            <span class="badge rounded-pill bg-success-subtle border text-success px-3 py-2">
                ● Professor - <%= professor %>
            </span>
        </div>

        <!-- Formulário -->
        
            <div class="row g-3">

                <!-- Tipo de nota -->
                <div class="col-12 col-md-8">
                    <label class="form-label fw-semibold">Tipo de Nota</label>
                    <select class="form-select" id="tipo">
                        <option selected disabled>Selecione</option>
                        <option value="Prova">Prova</option>
                        <option value="Trabalho">Trabalho</option>
                        <option value="Exercícios">Exercícios</option>
                        <option value="Presença">Presença</option>
                    </select>
                </div>

                <!-- Nota -->
                <div class="col-12 col-md-4">
                    <label class="form-label fw-semibold">Nota</label>
                    <input type="number" id="nota"
                           class="form-control"
                           placeholder="0 - 10"
                           step="0.1"
                           min="0"
                           max="10">
                </div>

                <!-- Botão -->
                <div class="col-12 text-end">
                    <button class="btn btn-primary w-100 w-md-auto px-4" onclick=enviarNota()>
                        Enviar Nota
                    </button>
                </div>
            </div>
        

        <!-- Listagem de notas -->
        <div class="mt-4">
            <h5 class="fw-bold mb-3">Notas Aplicadas</h5>

            <div class="table-responsive">
                <table class="table table-bordered table-striped align-middle small">
                    <thead class="table-primary">
                        <tr>
                            <th>Tipo</th>
                            <th>Nota</th>
                            <th>Data</th>
							<th>Hora</th>
							<th>Professor</th>
							<th></th>
                        </tr>
                    </thead>
                    <tbody>
						<% notasAlunos.forEach(dados=> { %>
                        <tr>
                            <td><%= dados.tipo %></td>
                            <td><%= dados.nota %></td>
                            <td><%= dados.data %></td>
							<td><%= dados.hora %></td>
							<td><%= dados.nome %></td>
							<td><a href="/remNotaAluno/<%= id_aluno %>/<%= id_professor %>/<%= id_materia %>/<%= modulo %>/<%= dados.id_notas_alunos %>"><i class="bi bi-trash-fill text-danger" style="cursor:pointer;"></i></a></td>
                        </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
	function enviarNota(){
		//alert(tipo);
		notaAluno();
	}
	function notaAluno() {
		alert();
		let tipo = document.getElementById('tipo').value;
		let nota = document.getElementById('nota').value;
		const postData = {
			id_professor: <%= id_professor %>,
			id_aluno: <%= id_aluno %>,
			id_materia: <%= id_materia %>,
			id_modulo: <%= modulo %>,
			data: dataAtualFormatada(),
			hora: horaAtual(),
			tipo,
			nota
		  };

	  fetch('/enviarNota', {
		method: 'POST',
		headers: { 'Content-Type': 'application/json' },
		body: JSON.stringify(postData)
	  })
	  .then(response => {
		if (!response.ok) throw new Error(`Erro HTTP! status: ${response.status}`);
		return response.json();
	  })
	  .then(() => {
		
		window.location.href = `/aluno_nota/<%= id_aluno %>/<%= id_professor %>/<%= id_materia %>/<%= modulo %>`
	  })
	  .catch(error => console.error('Erro:', error));
	}
	function horaAtual() {
      const data = new Date();
      return `${String(data.getHours()).padStart(2,"0")}:${String(data.getMinutes()).padStart(2,"0")}:${String(data.getSeconds()).padStart(2,"0")}`;
    }

    function dataAtualFormatada() {
      const data = new Date();
      return `${String(data.getDate()).padStart(2,"0")}/${String(data.getMonth()+1).padStart(2,"0")}/${data.getFullYear()}`;
    }
</script>
</body>
</html>
